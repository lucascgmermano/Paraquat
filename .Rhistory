library(dplyr)
library(stringr)
library(stringi)
library(stringdist)
library(foreign)
df_ini <- read.dbf("Dados_brutos/IEXOBR11.dbf")
# Converter todo o dataframe para utf8
df_ini <- as.data.frame(
lapply(df_ini, \(x)
if (is.character(x) || is.factor(x))
stri_enc_toutf8(as.character(x))
else
x
),
stringsAsFactors = FALSE
)
as.data.frame(
lapply(df_ini, \(x)
if (is.character(x) || is.factor(x))
stri_enc_toutf8(as.character(x))
else
x
),
stringsAsFactors = FALSE
)
as.data.frame(
lapply(df_ini, \(x)
if (is.character(x) || is.factor(x))
stringr::str_trim(x))
else
as.data.frame(
lapply(df_ini, \(x)
if (is.character(x) || is.factor(x))
stringr::str_trim(x))
else
# Seleciona colunas de interesse
cols_alvo <- grep("^(AGENTE|P_ATIVO)", names(df_ini), value = TRUE, ignore.case = TRUE)
as.data.frame(
lapply(df_ini[cols_alvo], \(x)
if (is.character(x) || is.factor(x))
stringr::str_trim(x))
else
as.data.frame(
lapply(df_ini[cols_alvo], function(x){
if (is.character(x) || is.factor(x))
stringr::str_trim(x)
else
x
),stringsAsFactors = FALSE})
df_ini[cols_alvo]
lapply(df_ini[cols_alvo], stringr::str_trim(x))
lapply(df_ini[cols_alvo], stringr::str_trim
lapply(df_ini[cols_alvo], stringr::str_trim)
lapply(df_ini[cols_alvo], stringr::str_trim)
stringr::str_trim(string = df_ini$AGENTE_1)
View(df_ini)
df_ini[cols_alvo]
df_ini[cols_alvo] %>% view
df_ini[cols_alvo] %>% View()
df_ini <- read.dbf("Dados_brutos/IEXOBR11.dbf")
# Converter todo o dataframe para utf8
df_ini <- as.data.frame(
lapply(df_ini, \(x)
if (is.character(x) || is.factor(x))
stri_enc_toutf8(as.character(x))
else
x
),
stringsAsFactors = FALSE
)
# Seleciona colunas de interesse
cols_alvo <- grep("^(AGENTE|P_ATIVO)", names(df_ini), value = TRUE, ignore.case = TRUE)
# Aplica a funcao de normalizacao sobre as colunas de interesse
df_ini[cols_alvo] <- lapply(df_ini[cols_alvo], stringr::str_to_lower)
df_ini[cols_alvo]
`%~in%` <- function(x, table, method = "lv", maxDist = 2) {
!is.na(amatch(x, table, method = method, maxDist = maxDist))
}
### Filtro definitivo (busca direta e indireta)
df_ini %>%
filter(if_any(c(starts_with("AGENTE"), starts_with("P_ATIVO")),
~ .x %in% nome_produto) |
if_any(c(starts_with("AGENTE"), starts_with("P_ATIVO")),
~ .x %~in% nome_produto)) %>% View
### Filtro definitivo (busca direta e indireta)
df_ini %>%
filter(if_any(c(starts_with("AGENTE"), starts_with("P_ATIVO")),
~ .x %in% nome_produto) |
if_any(c(starts_with("AGENTE"), starts_with("P_ATIVO")),
~ .x %~in% nome_produto)) %>% View()
### Filtro definitivo (busca direta e indireta)
df_ini %>%
filter(if_any(c(starts_with("AGENTE"), starts_with("P_ATIVO")),
~ .x %in% nome_produto) ||
if_any(c(starts_with("AGENTE"), starts_with("P_ATIVO")),
~ .x %~in% nome_produto)) %>% View
### Filtro definitivo (busca direta e indireta)
df_ini %>%
filter(if_any(c(starts_with("AGENTE"), starts_with("P_ATIVO")),
~ .x %in% nome_produto) |
if_any(c(starts_with("AGENTE"), starts_with("P_ATIVO")),
~ .x %~in% nome_produto)) %>% View
`%~in%` <- function(x, table, method = "lv", maxDist = 2) {
!is.na(amatch(x, table, method = method, maxDist = maxDist))
}
df_ini %>%
filter(
if_any(
c(starts_with("AGENTE"), starts_with("P_ATIVO")),
~ (.x %in% nome_produto) | (.x %~in% nome_produto)
)
) %>%
View()
library(foreign)
library(dplyr)
library(tidyr)
library(lubridate)
library(stringr)
library(stringdist)
!is.na(amatch(x, table, method = method, maxDist = maxDist))
`%~in%` <- function(x, table, method = "lv", maxDist = 2) {
!is.na(amatch(x, table, method = method, maxDist = maxDist))
}
df_ini %>%
filter(
if_any(
c(starts_with("AGENTE"), starts_with("P_ATIVO")),
~ (.x %in% nome_produto) | (.x %~in% nome_produto)
)
) %>%
View()
df_filtrado <- df_ini %>%
filter(
if_any(
c(starts_with("AGENTE"), starts_with("P_ATIVO")),
~ (.x %in% nome_produto) | (.x %~in% nome_produto)
)
)
nome_produto <- c("c12h14n2",
"bipiridínio",
"bipyridinium",
"flak 200",
"gramocil",
"gramoking",
"gramoking",
"gramoxone",
"gramoxone 200",
"helmoxone",
"laredo",
"nuquat",
"orbit",
"paradox",
"paraquat",
"paraquat 200 sl",
"paraquate",
"paraquate alta 200 sl",
"pramato",
"quatdown",
"sprayquat",
"tocha"
)
`%~in%` <- function(x, table, method = "lv", maxDist = 2) {
!is.na(amatch(x, table, method = method, maxDist = maxDist))
}
df_filtrado <- df_ini %>%
filter(
if_any(
c(starts_with("AGENTE"), starts_with("P_ATIVO")),
~ (.x %in% nome_produto) | (.x %~in% nome_produto)
)
)
View(df_filtrado)
df_ini %>% filter(if_any(c(starts_with("AGENTE"), starts_with("P_ATIVO")), ~ .x %in% nome_produto) | if_any(c(starts_with("AGENTE"), starts_with("P_ATIVO")), ~ .x %~in% nome_produto)) %>% View
`%~in%` <- function(x, table, method = "lv", maxDist = 1) {
!is.na(amatch(x, table, method = method, maxDist = maxDist))
}
df_filtrado <- df_ini %>%
filter(
if_any(
c(starts_with("AGENTE"), starts_with("P_ATIVO")),
~ (.x %in% nome_produto) | (.x %~in% nome_produto)
)
)
View(df_filtrado)
View(df_filtrado[cols_alvo])
df_ini[cols_alvo] %>%
df_ini[cols_alvo] %>%
filter(if_any(c(starts_with("AGENTE"), starts_with("P_ATIVO")),
~ .x %in% nome_produto))
df_ini[cols_alvo] %>%
filter(if_any(c(starts_with("AGENTE"), starts_with("P_ATIVO")),
~ .x %in% nome_produto))
stringi::stri_trans_general(str = df_ini$AGENTE_1, "Latin-ASCII")
lapply(df_ini[cols_alvo], stringi::stri_trans_general)
lapply(df_ini[cols_alvo], stringi::stri_trans_general("Latin-ASCII"))
lapply(df_ini[cols_alvo], stringi::stri_trans_general(id = x,"Latin-ASCII"))
lapply(df_ini[cols_alvo], stringi::stri_trans_general(id = df_ini[cols_alvo],"Latin-ASCII"))
lapply(df_ini[cols_alvo], stringi::stri_trans_general(str = df_ini[cols_alvo],"Latin-ASCII"))
lapply(df_ini[cols_alvo], function(x) {
stringi::stri_trans_general(str = x, id = "Latin-ASCII")
})
df_ini[cols_alvo] <- lapply(df_ini[cols_alvo], function(x) {
stringi::stri_trans_general(str = x, id = "Latin-ASCII")
})
df_ini[cols_alvo]
df_ini <- read.dbf("Dados_brutos/IEXOBR11.dbf")
# Converter todo o dataframe para utf8
df_ini <- as.data.frame(
lapply(df_ini, \(x)
if (is.character(x) || is.factor(x))
stri_enc_toutf8(as.character(x))
else
x
),
stringsAsFactors = FALSE
)
# Seleciona apenas as colunas sobre agentes
df_ini <- df_ini %>% select(starts_with("AGENTE"), starts_with("P_ATIVO"))
df_ini
df_ini <- read.dbf("Dados_brutos/IEXOBR11.dbf")
# Converter todo o dataframe para utf8
df_ini <- as.data.frame(
lapply(df_ini, \(x)
if (is.character(x) || is.factor(x))
stri_enc_toutf8(as.character(x))
else
x
),
stringsAsFactors = FALSE
)
# Seleciona apenas as colunas sobre agentes
cols_alvo <- df_ini %>% select(starts_with("AGENTE"), starts_with("P_ATIVO"))
cols_alvo
# Os dados ja estao sem acento e caracteres especiais, entao somente tornar para letra minuscula
## Letra minuscula
df_ini[cols_alvo] <- lapply(df_ini[cols_alvo], stringr::str_to_lower)
df_ini[cols_alvo]
cols_alvo
df_ini <- read.dbf("Dados_brutos/IEXOBR11.dbf")
# Converter todo o dataframe para utf8
df_ini <- as.data.frame(
lapply(df_ini, \(x)
if (is.character(x) || is.factor(x))
stri_enc_toutf8(as.character(x))
else
x
),
stringsAsFactors = FALSE
)
# Seleciona apenas nomes das colunas sobre agentes
cols_alvo <- grep("^(AGENTE|P_ATIVO)", names(df_ini), value = TRUE, ignore.case = TRUE)
# Os dados ja estao sem acento e caracteres especiais, entao somente tornar para letra minuscula
## Letra minuscula
df_ini[cols_alvo] <- lapply(df_ini[cols_alvo], stringr::str_to_lower)
df_ini[cols_alvo]
df_ini[cols_alvo] <- lapply(df_ini[cols_alvo], function(x) {
stringi::stri_trans_general(str = x, id = "Latin-ASCII")
})
lapply(df_ini[cols_alvo] , stringr::str_trim)
df_ini[cols_alvo]
## Remover espacial de inicio e final
df_ini[cols_alvo] <- lapply(df_ini[cols_alvo] , stringr::str_trim)
df_ini[cols_alvo] %>% View()
## Substitui multiplos espacos por apenas um
lapply(df_ini[cols_alvo], stringr::str_squish)
## Substitui multiplos espacos por apenas um
df_ini[cols_alvo] <- lapply(df_ini[cols_alvo], stringr::str_squish)
df_ini[cols_alvo] %>% View()
nome_produto <- c("c12h14n2",
"bipiridínio",
"bipyridinium",
"flak 200",
"gramocil",
"gramoking",
"gramoking",
"gramoxone",
"gramoxone 200",
"helmoxone",
"laredo",
"nuquat",
"orbit",
"paradox",
"paraquat",
"paraquat 200 sl",
"paraquate",
"paraquate alta 200 sl",
"pramato",
"quatdown",
"sprayquat",
"tocha"
)
library(foreign)
library(dplyr)
library(tidyr)
library(lubridate)
library(stringr)
library(stringdist)
df_ini <- read.dbf("Dados_brutos/IEXOBR11.dbf")
# Converter todo o dataframe para utf8
df_ini <- as.data.frame(
lapply(df_ini, \(x)
if (is.character(x) || is.factor(x))
stri_enc_toutf8(as.character(x))
else
x
),
stringsAsFactors = FALSE
)
# Seleciona apenas nomes das colunas sobre agentes
cols_alvo <- grep("^(AGENTE|P_ATIVO)", names(df_ini), value = TRUE, ignore.case = TRUE)
## Letra minuscula
df_ini[cols_alvo] <- lapply(df_ini[cols_alvo], stringr::str_to_lower)
## Remover caracteres especiais e acentos
df_ini[cols_alvo] <- lapply(df_ini[cols_alvo], function(x) {
stringi::stri_trans_general(str = x, id = "Latin-ASCII")
})
## Remover espacial de inicio e final
df_ini[cols_alvo] <- lapply(df_ini[cols_alvo] , stringr::str_trim)
## Substitui multiplos espacos por apenas um
df_ini[cols_alvo] <- lapply(df_ini[cols_alvo], stringr::str_squish)
nome_produto <- c("c12h14n2",
"bipiridínio",
"bipyridinium",
"flak 200",
"gramocil",
"gramoking",
"gramoking",
"gramoxone",
"gramoxone 200",
"helmoxone",
"laredo",
"nuquat",
"orbit",
"paradox",
"paraquat",
"paraquat 200 sl",
"paraquate",
"paraquate alta 200 sl",
"pramato",
"quatdown",
"sprayquat",
"tocha"
)
`%~in%` <- function(x, table, method = "lv", maxDist = 1) {
!is.na(amatch(x, table, method = method, maxDist = maxDist))
}
df_filtrado <- df_ini %>%
filter(
if_any(
c(starts_with("AGENTE"), starts_with("P_ATIVO")),
~ (.x %in% nome_produto) | (.x %~in% nome_produto)
)
)
View(df_filtrado[cols_alvo])
df_ini[cols_alvo] %>%
filter(if_any(c(starts_with("AGENTE"), starts_with("P_ATIVO")),
~ .x %in% nome_produto)) %>% View()
### Funcao para detectar semelhancas com distância de Levenshtein
`%~in%` <- function(x, table, method = "lv", maxDist = 2) {
!is.na(amatch(x, table, method = method, maxDist = maxDist))
}
df_filtrado <- df_ini %>%
filter(
if_any(
c(starts_with("AGENTE"), starts_with("P_ATIVO")),
~ (.x %in% nome_produto) | (.x %~in% nome_produto)
)
)
View(df_filtrado[cols_alvo])
### Funcao para detectar semelhancas com distância de Levenshtein
`%~in%` <- function(x, table, method = "lv", maxDist = 1) {
!is.na(amatch(x, table, method = method, maxDist = maxDist))
}
df_filtrado <- df_ini %>%
filter(
if_any(
c(starts_with("AGENTE"), starts_with("P_ATIVO")),
~ (.x %in% nome_produto) | (.x %~in% nome_produto)
)
)
View(df_filtrado[cols_alvo])
table(df_filtrado)
table(df_filtrado$AGENTE_1)
## Filtro Simples
df_filtrado_simples <- df_ini[cols_alvo] %>%
filter(if_any(c(starts_with("AGENTE"), starts_with("P_ATIVO")),
~ .x %in% nome_produto))
View(df_filtrado_simples)
